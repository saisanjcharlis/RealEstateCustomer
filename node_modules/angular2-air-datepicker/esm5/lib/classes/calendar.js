/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { AirOptions } from './options';
var AirCalendar = /** @class */ (function () {
    function AirCalendar(date, airOptions) {
        if (date === void 0) { date = new Date; }
        if (airOptions === void 0) { airOptions = new AirOptions; }
        this.daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        /** @type {?} */
        var currentDate = new Date;
        this.currentMonth = currentDate.getMonth();
        this.currentYear = currentDate.getFullYear();
        this.airOptions = airOptions;
        this.year = date.getFullYear();
        this.month = date.getMonth();
        this.date = date.getDate();
        this.hour = date.getHours();
        this.minute = date.getMinutes();
        this.updateCalendar();
    }
    /**
     * @return {?}
     */
    AirCalendar.prototype.updateCalendar = /**
     * @return {?}
     */
    function () {
        this.airDays = [];
        /** @type {?} */
        var daysInMonth = this.getDaysInMonth(this.month);
        /** @type {?} */
        var date = new Date;
        /** @type {?} */
        var firstDayOfMonth = ((new Date(this.year, this.month, 1)).getDay() || 7) - 1;
        // making 0 == monday
        /** @type {?} */
        var weekend = new AirWeekend;
        if (firstDayOfMonth /* is not monday (0) */) {
            /** @type {?} */
            var daysInLastMonth = this.getDaysInMonth(this.month - 1);
            /** @type {?} */
            var prevAirMonth = new AirMonth(this.month - 1, this.year);
            for (var dateNo = daysInLastMonth - firstDayOfMonth + 1; dateNo <= daysInLastMonth; dateNo++) {
                this.airDays.push(new AirDay(dateNo, weekend.progress(), this.airOptions.isDisabled(new Date(prevAirMonth.year, prevAirMonth.month, dateNo)), true));
            }
        }
        for (var dateNo = 1; dateNo <= daysInMonth; dateNo++) {
            this.airDays.push(new AirDay(dateNo, weekend.progress(), this.airOptions.isDisabled(new Date(this.year, this.month, dateNo))));
        }
        if (this.date > daysInMonth) {
            this.date = daysInMonth; // select the maximum available this month instead
        }
        // set the current date if it's the current month & year
        if (date.getMonth() == this.month && date.getFullYear() == this.year) {
            this.airDays[firstDayOfMonth + date.getDate() - 1].current = true;
        }
        /** @type {?} */
        var daysSoFar = firstDayOfMonth + daysInMonth;
        /** @type {?} */
        var nextAirMonth = new AirMonth(this.month + 1, this.year);
        for (var dateNo = 1; dateNo <= (daysSoFar > 35 ? 42 : 35) - daysSoFar; dateNo++) {
            this.airDays.push(new AirDay(dateNo, weekend.progress(), this.airOptions.isDisabled(new Date(nextAirMonth.year, nextAirMonth.month, dateNo)), true));
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    AirCalendar.prototype.selectDate = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.date = this.airDays[index].date;
        // might be a day from the previous/next month
        if (index < 7 && this.date > 20) {
            this.setMonth(this.month - 1);
        }
        else if (index > 20 && this.date < 8) {
            this.setMonth(this.month + 1);
        }
    };
    /**
     * @param {?} month
     * @return {?}
     */
    AirCalendar.prototype.setMonth = /**
     * @param {?} month
     * @return {?}
     */
    function (month) {
        /** @type {?} */
        var airMonth = new AirMonth(month, this.year);
        this.month = airMonth.month;
        this.year = airMonth.year;
        this.updateCalendar();
    };
    /**
     * @param {?} year
     * @return {?}
     */
    AirCalendar.prototype.setYear = /**
     * @param {?} year
     * @return {?}
     */
    function (year) {
        this.year = year;
    };
    /**
     * @param {?} month
     * @return {?}
     */
    AirCalendar.prototype.getDaysInMonth = /**
     * @param {?} month
     * @return {?}
     */
    function (month) {
        /** @type {?} */
        var airMonth = new AirMonth(month, this.year);
        if (airMonth.month == 1 && ((airMonth.year % 4 == 0) && (airMonth.year % 100 != 0)) || (airMonth.year % 400 == 0)) {
            return 29;
        }
        return this.daysInMonth[airMonth.month];
    };
    return AirCalendar;
}());
export { AirCalendar };
if (false) {
    /** @type {?} */
    AirCalendar.prototype.daysInMonth;
    /** @type {?} */
    AirCalendar.prototype.airOptions;
    /** @type {?} */
    AirCalendar.prototype.airDays;
    /** @type {?} */
    AirCalendar.prototype.currentMonth;
    /** @type {?} */
    AirCalendar.prototype.currentYear;
    /** @type {?} */
    AirCalendar.prototype.year;
    /** @type {?} */
    AirCalendar.prototype.month;
    /** @type {?} */
    AirCalendar.prototype.date;
    /** @type {?} */
    AirCalendar.prototype.hour;
    /** @type {?} */
    AirCalendar.prototype.minute;
}
// normalizes month/year
var 
// normalizes month/year
AirMonth = /** @class */ (function () {
    function AirMonth(month, year) {
        if (month > 11) {
            year++;
            month = 0;
        }
        else if (month < 0) {
            year--;
            month = 11;
        }
        this.month = month;
        this.year = year;
    }
    return AirMonth;
}());
// normalizes month/year
export { AirMonth };
if (false) {
    /** @type {?} */
    AirMonth.prototype.month;
    /** @type {?} */
    AirMonth.prototype.year;
}
var AirDay = /** @class */ (function () {
    function AirDay(date, weekend, disabled, other, current) {
        if (weekend === void 0) { weekend = false; }
        if (disabled === void 0) { disabled = false; }
        if (other === void 0) { other = false; }
        if (current === void 0) { current = false; }
        this.date = date;
        this.weekend = weekend;
        this.disabled = disabled;
        this.other = other;
        this.current = current;
    }
    return AirDay;
}());
export { AirDay };
if (false) {
    /** @type {?} */
    AirDay.prototype.date;
    /** @type {?} */
    AirDay.prototype.weekend;
    /** @type {?} */
    AirDay.prototype.other;
    /** @type {?} */
    AirDay.prototype.current;
    /** @type {?} */
    AirDay.prototype.disabled;
}
var AirWeekend = /** @class */ (function () {
    function AirWeekend(day) {
        if (day === void 0) { day = 0; }
        this.day = day;
    }
    /**
     * @return {?}
     */
    AirWeekend.prototype.progress = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var weekend = false;
        if (this.day == 5 /* Saturday */) {
            weekend = true;
            ++this.day;
        }
        else if (this.day == 6 /* Sunday */) {
            weekend = true;
            this.day = 0; // it's a new week!
        }
        else {
            ++this.day;
        }
        return weekend;
    };
    return AirWeekend;
}());
export { AirWeekend };
if (false) {
    /** @type {?} */
    AirWeekend.prototype.day;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1haXItZGF0ZXBpY2tlci8iLCJzb3VyY2VzIjpbImxpYi9jbGFzc2VzL2NhbGVuZGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXZDO0lBWUUscUJBQWEsSUFBcUIsRUFBRSxVQUF1QztRQUE5RCxxQkFBQSxFQUFBLFdBQWlCLElBQUk7UUFBRSwyQkFBQSxFQUFBLGlCQUE2QixVQUFVO1FBWDNFLGdCQUFXLEdBQWtCLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsQ0FBQzs7WUFZeEUsV0FBVyxHQUFHLElBQUksSUFBSTtRQUM1QixJQUFJLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM3QyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7OztJQUVELG9DQUFjOzs7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QUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDLEFBZEQsSUFjQzs7OztJQWJDLHNCQUFhOztJQUNiLHlCQUFpQjs7SUFDakIsdUJBQWU7O0lBQ2YseUJBQWlCOztJQUNqQiwwQkFBa0I7O0FBV3BCO0lBR0Usb0JBQWEsR0FBZTtRQUFmLG9CQUFBLEVBQUEsT0FBZTtRQUMxQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNqQixDQUFDOzs7O0lBRUQsNkJBQVE7OztJQUFSOztZQUNNLE9BQU8sR0FBRyxLQUFLO1FBRW5CLElBQUksSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsY0FBYyxFQUFFO1lBQ2hDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDZixFQUFFLElBQUksQ0FBQyxHQUFHLENBQUM7U0FDWjthQUFNLElBQUksSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsWUFBWSxFQUFFO1lBQ3JDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDZixJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtTQUNsQzthQUFNO1lBQ0wsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQ1o7UUFFRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBdEJELElBc0JDOzs7O0lBckJDLHlCQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWlyT3B0aW9ucyB9IGZyb20gJy4vb3B0aW9ucyc7XG5cbmV4cG9ydCBjbGFzcyBBaXJDYWxlbmRhciB7XG4gIGRheXNJbk1vbnRoOiBBcnJheTxudW1iZXI+ID0gWyAzMSwgMjgsIDMxLCAzMCwgMzEsIDMwLCAzMSwgMzEsIDMwLCAzMSwgMzAsIDMxIF07XG4gIGFpck9wdGlvbnM6IEFpck9wdGlvbnM7XG4gIGFpckRheXM6IEFycmF5PEFpckRheT47XG4gIGN1cnJlbnRNb250aDogbnVtYmVyO1xuICBjdXJyZW50WWVhcjogbnVtYmVyO1xuICB5ZWFyOiBudW1iZXI7XG4gIG1vbnRoOiBudW1iZXI7XG4gIGRhdGU6IG51bWJlcjtcbiAgaG91cjogbnVtYmVyO1xuICBtaW51dGU6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvciAoZGF0ZTogRGF0ZSA9IG5ldyBEYXRlLCBhaXJPcHRpb25zOiBBaXJPcHRpb25zID0gbmV3IEFpck9wdGlvbnMpIHtcbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlO1xuICAgIHRoaXMuY3VycmVudE1vbnRoID0gY3VycmVudERhdGUuZ2V0TW9udGgoKTtcbiAgICB0aGlzLmN1cnJlbnRZZWFyID0gY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICB0aGlzLmFpck9wdGlvbnMgPSBhaXJPcHRpb25zO1xuICAgIHRoaXMueWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICB0aGlzLm1vbnRoID0gZGF0ZS5nZXRNb250aCgpO1xuICAgIHRoaXMuZGF0ZSA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgIHRoaXMuaG91ciA9IGRhdGUuZ2V0SG91cnMoKTtcbiAgICB0aGlzLm1pbnV0ZSA9IGRhdGUuZ2V0TWludXRlcygpO1xuICAgIHRoaXMudXBkYXRlQ2FsZW5kYXIoKTtcbiAgfVxuXG4gIHVwZGF0ZUNhbGVuZGFyICgpIHtcbiAgICB0aGlzLmFpckRheXMgPSBbXTtcbiAgICBjb25zdCBkYXlzSW5Nb250aCA9IHRoaXMuZ2V0RGF5c0luTW9udGgodGhpcy5tb250aCk7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlO1xuICAgIGNvbnN0IGZpcnN0RGF5T2ZNb250aCA9ICgobmV3IERhdGUodGhpcy55ZWFyLCB0aGlzLm1vbnRoLCAxKSkuZ2V0RGF5KCkgfHwgNykgLSAxOyAvLyBtYWtpbmcgMCA9PSBtb25kYXlcbiAgICBjb25zdCB3ZWVrZW5kID0gbmV3IEFpcldlZWtlbmQ7XG5cbiAgICBpZiAoZmlyc3REYXlPZk1vbnRoLyogaXMgbm90IG1vbmRheSAoMCkgKi8pIHtcbiAgICAgIGNvbnN0IGRheXNJbkxhc3RNb250aCA9IHRoaXMuZ2V0RGF5c0luTW9udGgodGhpcy5tb250aCAtIDEpO1xuICAgICAgY29uc3QgcHJldkFpck1vbnRoID0gbmV3IEFpck1vbnRoKHRoaXMubW9udGggLSAxLCB0aGlzLnllYXIpO1xuICAgICAgZm9yIChsZXQgZGF0ZU5vID0gZGF5c0luTGFzdE1vbnRoIC0gZmlyc3REYXlPZk1vbnRoICsgMTsgZGF0ZU5vIDw9IGRheXNJbkxhc3RNb250aDsgZGF0ZU5vKyspIHtcbiAgICAgICAgdGhpcy5haXJEYXlzLnB1c2goXG4gICAgICAgICAgbmV3IEFpckRheShkYXRlTm8sIHdlZWtlbmQucHJvZ3Jlc3MoKSwgdGhpcy5haXJPcHRpb25zLmlzRGlzYWJsZWQobmV3IERhdGUocHJldkFpck1vbnRoLnllYXIsIHByZXZBaXJNb250aC5tb250aCwgZGF0ZU5vKSksIHRydWUpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yIChsZXQgZGF0ZU5vID0gMTsgZGF0ZU5vIDw9IGRheXNJbk1vbnRoOyBkYXRlTm8rKykge1xuICAgICAgdGhpcy5haXJEYXlzLnB1c2gobmV3IEFpckRheShkYXRlTm8sIHdlZWtlbmQucHJvZ3Jlc3MoKSwgdGhpcy5haXJPcHRpb25zLmlzRGlzYWJsZWQobmV3IERhdGUodGhpcy55ZWFyLCB0aGlzLm1vbnRoLCBkYXRlTm8pKSkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRhdGUgPiBkYXlzSW5Nb250aCkge1xuICAgICAgdGhpcy5kYXRlID0gZGF5c0luTW9udGg7IC8vIHNlbGVjdCB0aGUgbWF4aW11bSBhdmFpbGFibGUgdGhpcyBtb250aCBpbnN0ZWFkXG4gICAgfVxuXG4gICAgLy8gc2V0IHRoZSBjdXJyZW50IGRhdGUgaWYgaXQncyB0aGUgY3VycmVudCBtb250aCAmIHllYXJcbiAgICBpZiAoZGF0ZS5nZXRNb250aCgpID09IHRoaXMubW9udGggJiYgZGF0ZS5nZXRGdWxsWWVhcigpID09IHRoaXMueWVhcikge1xuICAgICAgdGhpcy5haXJEYXlzW2ZpcnN0RGF5T2ZNb250aCArIGRhdGUuZ2V0RGF0ZSgpIC0gMV0uY3VycmVudCA9IHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgZGF5c1NvRmFyID0gZmlyc3REYXlPZk1vbnRoICsgZGF5c0luTW9udGg7XG4gICAgY29uc3QgbmV4dEFpck1vbnRoID0gbmV3IEFpck1vbnRoKHRoaXMubW9udGggKyAxLCB0aGlzLnllYXIpO1xuICAgIGZvciAobGV0IGRhdGVObyA9IDE7IGRhdGVObyA8PSAoZGF5c1NvRmFyID4gMzUgPyA0MiA6IDM1KSAtIGRheXNTb0ZhcjsgZGF0ZU5vKyspIHtcbiAgICAgIHRoaXMuYWlyRGF5cy5wdXNoKFxuICAgICAgICBuZXcgQWlyRGF5KGRhdGVObywgd2Vla2VuZC5wcm9ncmVzcygpLCB0aGlzLmFpck9wdGlvbnMuaXNEaXNhYmxlZChuZXcgRGF0ZShuZXh0QWlyTW9udGgueWVhciwgbmV4dEFpck1vbnRoLm1vbnRoLCBkYXRlTm8pKSwgdHJ1ZSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgc2VsZWN0RGF0ZSAoaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuZGF0ZSA9IHRoaXMuYWlyRGF5c1tpbmRleF0uZGF0ZTtcblxuICAgIC8vIG1pZ2h0IGJlIGEgZGF5IGZyb20gdGhlIHByZXZpb3VzL25leHQgbW9udGhcbiAgICBpZiAoaW5kZXggPCA3ICYmIHRoaXMuZGF0ZSA+IDIwKSB7XG4gICAgICB0aGlzLnNldE1vbnRoKHRoaXMubW9udGggLSAxKTtcbiAgICB9IGVsc2UgaWYgKGluZGV4ID4gMjAgJiYgdGhpcy5kYXRlIDwgOCkge1xuICAgICAgdGhpcy5zZXRNb250aCh0aGlzLm1vbnRoICsgMSk7XG4gICAgfVxuICB9XG5cbiAgc2V0TW9udGggKG1vbnRoOiBudW1iZXIpIHtcbiAgICBjb25zdCBhaXJNb250aDogQWlyTW9udGggPSBuZXcgQWlyTW9udGgobW9udGgsIHRoaXMueWVhcik7XG4gICAgdGhpcy5tb250aCA9IGFpck1vbnRoLm1vbnRoO1xuICAgIHRoaXMueWVhciA9IGFpck1vbnRoLnllYXI7XG4gICAgdGhpcy51cGRhdGVDYWxlbmRhcigpO1xuICB9XG5cbiAgc2V0WWVhciAoeWVhcjogbnVtYmVyKSB7XG4gICAgdGhpcy55ZWFyID0geWVhcjtcbiAgfVxuXG4gIGdldERheXNJbk1vbnRoIChtb250aDogbnVtYmVyKSB7XG4gICAgY29uc3QgYWlyTW9udGg6IEFpck1vbnRoID0gbmV3IEFpck1vbnRoKG1vbnRoLCB0aGlzLnllYXIpO1xuICAgIGlmIChhaXJNb250aC5tb250aCA9PSAxICYmICgoYWlyTW9udGgueWVhciAlIDQgPT0gMCkgJiYgKGFpck1vbnRoLnllYXIgJSAxMDAgIT0gMCkpIHx8IChhaXJNb250aC55ZWFyICUgNDAwID09IDApKSB7XG4gICAgICByZXR1cm4gMjk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZGF5c0luTW9udGhbYWlyTW9udGgubW9udGhdO1xuICB9XG59XG5cbi8vIG5vcm1hbGl6ZXMgbW9udGgveWVhclxuZXhwb3J0IGNsYXNzIEFpck1vbnRoIHtcbiAgbW9udGg6IG51bWJlcjtcbiAgeWVhcjogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yIChtb250aCwgeWVhcikge1xuICAgIGlmIChtb250aCA+IDExKSB7XG4gICAgICB5ZWFyKys7XG4gICAgICBtb250aCA9IDA7XG4gICAgfSBlbHNlIGlmIChtb250aCA8IDApIHtcbiAgICAgIHllYXItLTtcbiAgICAgIG1vbnRoID0gMTE7XG4gICAgfVxuXG4gICAgdGhpcy5tb250aCA9IG1vbnRoO1xuICAgIHRoaXMueWVhciA9IHllYXI7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFpckRheSB7XG4gIGRhdGU6IG51bWJlcjtcbiAgd2Vla2VuZDogYm9vbGVhbjtcbiAgb3RoZXI6IGJvb2xlYW47XG4gIGN1cnJlbnQ6IGJvb2xlYW47XG4gIGRpc2FibGVkOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yIChkYXRlOiBudW1iZXIsIHdlZWtlbmQgPSBmYWxzZSwgZGlzYWJsZWQgPSBmYWxzZSwgb3RoZXIgPSBmYWxzZSwgY3VycmVudCA9IGZhbHNlKSB7XG4gICAgdGhpcy5kYXRlID0gZGF0ZTtcbiAgICB0aGlzLndlZWtlbmQgPSB3ZWVrZW5kO1xuICAgIHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgICB0aGlzLm90aGVyID0gb3RoZXI7XG4gICAgdGhpcy5jdXJyZW50ID0gY3VycmVudDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQWlyV2Vla2VuZCB7XG4gIGRheTogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yIChkYXk6IG51bWJlciA9IDApIHtcbiAgICB0aGlzLmRheSA9IGRheTtcbiAgfVxuXG4gIHByb2dyZXNzICgpOiBib29sZWFuIHtcbiAgICBsZXQgd2Vla2VuZCA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMuZGF5ID09IDUgLyogU2F0dXJkYXkgKi8pIHtcbiAgICAgIHdlZWtlbmQgPSB0cnVlO1xuICAgICAgKyt0aGlzLmRheTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZGF5ID09IDYgLyogU3VuZGF5ICovKSB7XG4gICAgICB3ZWVrZW5kID0gdHJ1ZTtcbiAgICAgIHRoaXMuZGF5ID0gMDsgLy8gaXQncyBhIG5ldyB3ZWVrIVxuICAgIH0gZWxzZSB7XG4gICAgICArK3RoaXMuZGF5O1xuICAgIH1cblxuICAgIHJldHVybiB3ZWVrZW5kO1xuICB9XG59XG4iXX0=